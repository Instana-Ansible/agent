# playbooks/deploy_instana.yml
---
- name: Deploy Instana Linux Agent
  hosts: instana_agents
  become: yes  # sudo su - get root access
  
  tasks:
    # Create instana-agent folder under /root on target host
    - name: 创建安装目录
      file:
        path: /root/instana-agent
        state: directory
        owner: root
        group: root
        mode: '0700'
    
    # Copy Instana agent RPM to /root/instana-agent 
    - name: 复制 RPM 文件
      copy:
        src: "{{ instana_rpm_path }}"
        dest: /root/instana-agent/
        mode: '0644'

    # Install Instana agent 
    - name: 安装 Instana Agent
      shell: "rpm -ivh /root/instana-agent/instana-agent-static-j9-20251007-1723.x86_64.rpm"
      args:
        warn: false  
      register: install_result