# playbooks/deploy_instana.yml
---
- name: Deploy Instana Linux Agent
  hosts: instana_agents
  become: yes  # sudo su - get root access
  
  tasks:
    # Create instana-agent folder under /root on target host
    - name: Create agent folder
      file:
        path: /root/instana-agent
        state: directory
        owner: root
        group: root
        mode: '0700'
    
    # Copy Instana agent RPM to /root/instana-agent 
    - name: Copy agent RPM file
      copy:
        src: "{{ instana_rpm_path }}"
        dest: /root/instana-agent/
        mode: '0644'

    # Install Instana agent 
    - name: Install Instana Agent
      command: rpm -ivh /root/instana-agent/instana-agent-static-j9-20251007-1723.x86_64.rpm
      register: install_result
      ignore_errors: yes  